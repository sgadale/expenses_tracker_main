{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">

    <!-- Dashboard Header -->
    <h2 class="mb-4">Dashboard</h2>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>Total Expense</h6>
                    <h4>₹{{ total_expense }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>Budget</h6>
                    <h4>₹{{ budget_amount }}</h4>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h6>Remaining</h6>
                    <h4>₹{{ remaining_amount }}</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Row -->
    <div class="d-flex align-items-center gap-2 mb-4">

        <!-- Add Expense Button -->
        <button
            class="btn btn-success"
            data-bs-toggle="modal"
            data-bs-target="#addExpenseModal">
            + Add Expense
        </button>

        <!-- Set Budget Button -->
        <button
            class="btn btn-secondary"
            data-bs-toggle="modal"
            data-bs-target="#setBudgetModal">
            Set Budget
        </button>

        <!-- Filter -->
        <form method="get" class="d-flex align-items-center ms-auto gap-2">
            <input
                type="month"
                name="month"
                class="form-control"
                value="{{ selected_month }}">
            <button class="btn btn-primary" type="submit">Filter</button>
        </form>
    </div>

    <!-- Tabs -->
    <ul class="nav nav-tabs mb-3" role="tablist">
        <li class="nav-item">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#expensesTab">
                Expenses
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#categoryTab">
                Category-wise Total
            </button>
        </li>
    </ul>

    <div class="tab-content">

        <!-- Expenses Tab -->
        <div class="tab-pane fade show active" id="expensesTab">
            <table class="table table-bordered table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>Title</th>
                        <th>Category</th>
                        <th>Amount</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody>
                    {% for expense in expenses %}
                    <tr>
                        <td>{{ expense.title }}</td>
                        <td>{{ expense.category }}</td>
                        <td>₹{{ expense.amount }}</td>
                        <td>{{ expense.date }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="4" class="text-center">No expenses found</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Category Tab -->
        <div class="tab-pane fade" id="categoryTab">
            <table class="table table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Category</th>
                        <th>Total Amount</th>
                    </tr>
                </thead>
                <tbody>
                    {% for row in category_totals %}
                    <tr>
                        <td>{{ row.category }}</td>
                        <td>₹{{ row.total }}</td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="2" class="text-center">No data</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

    </div>
</div>

<!-- ================= ADD EXPENSE MODAL ================= -->
<div class="modal fade" id="addExpenseModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'add_expense' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Add Expense</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {{ expense_form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-success">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- ================= SET BUDGET MODAL ================= -->
<div class="modal fade" id="setBudgetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="{% url 'set_budget' %}">
                {% csrf_token %}
                <div class="modal-header">
                    <h5 class="modal-title">Set Monthly Budget</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    {{ budget_form.as_p }}
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}
